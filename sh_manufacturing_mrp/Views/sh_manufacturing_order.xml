<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- form view -->

    <record id="sh_manufacturing_order_inherited_form" model="ir.ui.view">
        <field name="name">sh_manufacturing_order_inherited_form</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='miscellaneous']" position="after">
                <page string="Checklist">
                    <group>
                        <field name="checklist_completed" widget="percentpie"/>
                        <field name="checklist_template_id" widget="many2many_tags"/>
                        <field name="checklist_line_ids" nolabel="1" >
                            <list editable="bottom">
                                <field name="name" />
                                <field name="description" />
                                <field name="date" />
                                <field name="state" decoration-success="state == 'Completed'" decoration-danger="state == 'Cancelled'" decoration-primary="state == 'New'" widget="badge"/>
                                <button name="complete_button" string="complete" type="object" invisible="state=='Completed'"></button>
                                <button name="cancle_button" string="cancle" type="object" invisible="state=='Cancelled'"></button>
                            </list>
                        </field>
                    </group>


                </page>
            </xpath>
        </field>
    </record>


    <!-- list view -->

        <record id="sh_manufacturing_order_inherited_tree" model="ir.ui.view">
            <field name="name">sh_manufacturing_order_inherited_tree</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_tree_view" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="checklist_completed" widget="progressbar" />
                </xpath>
            </field>
        </record>


        <!-- kanban view -->

        <record id="sh_manufacturing_order_inherited_kanban" model="ir.ui.view">
            <field name="name">sh_manufacturing_order_inherited_kanban</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_kanban_view" />
            <field name="arch" type="xml">
                <xpath expr="//div[@class='d-flex mb-1']" position="after">
                    <div class="d-flex mb-1">

                        <field name="checklist_completed" widget="percentpie" string="checklist"/>
                        <!-- <p>checklist</p> -->

                    </div>
                </xpath>
            </field>
        </record>


        <!-- search view -->

        <record id="sh_manufacturing_order_inherited_search_view" model="ir.ui.view">
            <field name="name">sh_manufacturing_order_inherited_search</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.view_mrp_production_filter" />
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='activities_exception']" position="after">
                    <filter name="checklist_completed_full" string="Completed checklist" domain="[('checklist_completed','=','100.00')]"/>
                </xpath>
                <xpath expr="//filter[@name='activities_exception']" position="after">
                    <filter name="checklist_completed_not_full" string="Uncompleted checklist" domain="[('checklist_completed','&lt;','100.00')]"/>
                </xpath>
            </field>
        </record>


        <!-- report pdf -->

        <template id="sh_manufacturing_qweb_report"  inherit_id="mrp.report_mrp_production_components">
            <xpath expr="//table" position="after">
                <h3>
                    <span>
                        CheckList
                    </span>
                </h3>

                <strong>Completed CheckList:</strong>
                <span t-field="o.checklist_completed"></span>

                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Date</th>
                            <th>State</th>
                        </tr>
                    </thead>
                    <tr t-foreach="o.checklist_line_ids" t-as="raw_line">
                        <td>
                            <span t-field="raw_line.name"></span>
                        </td>
                        <td>
                            <span t-field="raw_line.description"></span>
                        </td>
                        <td>
                            <span t-field="raw_line.date"></span>
                        </td>
                        <td>
                            <span t-field="raw_line.state"></span>
                        </td>
                    </tr>
                </table>

            </xpath>
        </template>

</odoo>